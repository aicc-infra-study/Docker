도커 네트워크(Docker Network)는 컨테이너 간의 통신을 설정하고, 컨테이너가 서로 또는 외부와 데이터를 주고받을 수 있도록 관리하는 도커의 핵심 기능 중 하나이다.  네트워크 설정을 통해 **컨테이너 간 연결**, **외부 접근**, **보안 격리** 등을 쉽게 구현할 수 있다.

## **네트워크 모드와 네트워크 종류의 관계**

도커 네트워크 모드는 **컨테이너가 어떤 네트워크 종류를 사용할지 설정하는 방식**을 의미합니다. 네트워크 종류는 도커가 제공하는 여러 네트워크 드라이버에 기반하며, 각 모드는 컨테이너의 통신 방식과 격리 수준을 정의합니다.

### **기본 제공되는 네트워크 모드 (네트워크 종류)**

| **네트워크 모드** | **설명** |
| --- | --- |
| **bridge** | 기본 네트워크. 컨테이너 간 내부 통신을 지원하며, 외부 접근은 포트 매핑을 통해 가능. |
| **host** | 컨테이너가 호스트 네트워크를 직접 사용. 성능은 뛰어나지만 보안 격리가 없음. |
| **overlay** | 여러 호스트 간 네트워크를 생성하여 컨테이너 간 통신을 지원. 클러스터 환경에서 주로 사용. |
| **none** | 네트워크를 비활성화. 컨테이너가 외부 및 다른 컨테이너와 통신할 수 없음. |
| **macvlan** | 컨테이너에 고유한 네트워크 인터페이스와 MAC 주소를 부여. 네트워크 장치처럼 동작. |

---

## **네트워크 모드(종류) 별 동작 방식**

### **1. 브리지 네트워크 (bridge)**

- **설명**: 기본적으로 컨테이너는 **`bridge`** 네트워크에 연결됩니다. 컨테이너 간 통신은 내부적으로 가능하지만, 외부 접근은 명시적으로 포트를 매핑해야 합니다.
- **특징**:
    - 컨테이너는 내부 IP를 통해 같은 네트워크에 있는 다른 컨테이너와 통신 가능.
    - 외부 접근은 **`p`** 옵션으로 포트 매핑 필요.
- **사용 사례**:
    - 로컬 개발 환경.
    - 컨테이너 간 기본 통신이 필요한 간단한 네트워크.

### **예제:**

```bash
docker network create my-bridge
docker run --network my-bridge --name app1 -d nginx
docker run --network my-bridge --name app2 -d alpine
docker exec app2 ping app1
```

---

### **2. 호스트 네트워크 (host)**

- **설명**: 컨테이너가 호스트의 네트워크 스택을 직접 사용. 네트워크 레이어가 없으므로 컨테이너와 호스트가 동일한 IP와 포트를 공유합니다.
- **특징**:
    - 성능이 뛰어나지만 보안 격리가 없습니다.
    - 컨테이너 내부 포트와 호스트 포트가 동일.
- **사용 사례**:
    - 고성능이 필요한 서비스 (예: 게임 서버).
    - 네트워크 설정이 간단해야 하는 경우.

### **예제:**

```bash
docker run --network host -d nginx
```

---

### **3. 오버레이 네트워크 (overlay)**

- **설명**: 여러 도커 호스트 간의 네트워크를 생성하여 컨테이너 간 통신을 지원합니다. 주로 클러스터 환경에서 사용됩니다.
- **특징**:
    - Docker Swarm, Kubernetes와 같은 오케스트레이션 도구에서 주로 사용.
    - 암호화된 트래픽 지원.
- **사용 사례**:
    - 분산 애플리케이션.
    - 여러 서버 간의 컨테이너 통신.
- **예제:**
    
    ## **예시 : 전자상거래 웹사이트**
    
    ### **시나리오**
    
    - 대규모 전자상거래 웹사이트를 운영.
    - 많은 사용자가 동시에 웹사이트를 이용하며, 이를 처리하려면 여러 서버로 부하를 분산해야 함.
    - 서비스는 다음과 같이 구성됨:
        1. **프론트엔드**: React로 개발된 사용자 인터페이스.
        2. **백엔드 API**: Node.js로 구현된 API 서버.
        3. **데이터베이스**: postgreSQL 데이터베이스 서버.
    
    ---
    
    ### **구성**
    
    1. **호스트 A**: 프론트엔드 컨테이너 실행.
        - React 앱이 실행되며, 사용자의 요청을 백엔드 API로 전달.
    2. **호스트 B**: 백엔드 API 컨테이너 실행.
        - Node.js 앱이 실행되며, 데이터베이스와 통신해 사용자의 요청 처리.
    3. **호스트 C**: 데이터베이스 컨테이너 실행.
        - postgreSQL 서버가 실행되어 데이터를 저장 및 제공.
    4. **오버레이 네트워크**:
        - 이 세 호스트를 연결하여, 서로 다른 호스트에서 실행되는 컨테이너 간 통신이 가능하도록 설정.
    
    ---
    
    ### **실제 동작**
    
    - 사용자가 웹사이트에 접속:
        1. React 앱(호스트 A)이 백엔드 API(호스트 B)에 요청 전송.
        2. 백엔드 API(호스트 B)가 데이터베이스(호스트 C)에서 필요한 데이터를 가져옴.
        3. 백엔드 API가 응답을 프론트엔드에 전달.
        4. 사용자가 브라우저에서 결과를 확인.
    
    ---
    
    ### **구현 명령어**
    
    ### **1) Docker Swarm 클러스터 초기화**
    
    호스트 A에서 Swarm 클러스터 초기화:
    
    ```bash
    docker swarm init --advertise-addr <호스트 A IP>
    ```
    
    호스트 B와 C를 클러스터에 추가:
    
    ```bash
    docker swarm join --token <토큰> <호스트 A IP>:2377
    ```
    
    ### **2) 오버레이 네트워크 생성**
    
    ```bash
    docker network create \ --driver overlay \ my-overlay-network
    ```
    
    ### **3) 서비스 배포**
    
    **프론트엔드 서비스** (호스트 A):
    
    ```bash
    docker service create \
      --name frontend \
      --network my-overlay-network \
      -p 8080:80 \
      react-app
    ```
    
    **백엔드 서비스** (호스트 B):
    
    ```bash
    docker service create \
      --name backend \
      --network my-overlay-network \
      -p 3000:3000 \
      node-backend
    ```
    
    **데이터베이스 서비스** (호스트 C):
    
    ```bash
    docker service create \
      --name database \
      --network my-overlay-network \
      postgresql
    ```
    
    ---
    

---

### **4. 없음 (none)**

- **설명**: 네트워크를 완전히 비활성화. 컨테이너가 외부 네트워크나 다른 컨테이너와 통신할 수 없습니다.
- **특징**:
    - 컨테이너가 독립적으로 동작.
    - 네트워크 연결이 필요 없는 작업에 적합.
- **사용 사례**:
    - 데이터 분석.
    - 네트워크 통신이 필요 없는 독립 작업.

### **예제:**

```bash
docker run --network none -d alpine
```

---

### **5. Macvlan 네트워크**

- **설명**: 컨테이너에 고유한 네트워크 인터페이스와 MAC 주소를 부여하여 네트워크 장치처럼 동작하게 합니다.
- **특징**:
    - 컨테이너가 실제 네트워크 장치로 동작.
    - 기존 네트워크와의 통합이 필요할 때 유용.
- **사용 사례**:
    - 컨테이너가 물리적 네트워크에 직접 연결되어야 하는 경우.
    - 네트워크 격리가 필요 없고 IP 충돌을 방지하고 싶을 때.

### **예제:**

```bash
docker network create \
  --driver macvlan \
  --subnet=192.168.1.0/24 \
  --gateway=192.168.1.1 \
  -o parent=eth0 \
  macvlan-network
docker run --network macvlan-network -d nginx
```

---

## **네트워크 모드 지정 방법**

### **컨테이너 생성 시 지정**

- **`-network`** 옵션으로 네트워크 모드를 명시:

```bash
docker run --network <네트워크 모드> <이미지>
```

### **이미 생성된 네트워크에 연결**

- 이미 실행 중인 컨테이너에 네트워크를 추가:

```bash
docker network connect <네트워크 이름> <컨테이너 이름>
```

---