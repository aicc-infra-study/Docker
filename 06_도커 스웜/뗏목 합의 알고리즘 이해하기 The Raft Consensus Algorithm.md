### 1. 서론 🎬 뗏목 알고리즘의 명칭 유래와 초기 이해

- 영상의 조회수는 높지 않을 것으로 예상되지만, **뗏목 알고리즘** 의 이론적 설명은 필수적이다 .
- **뗏목 알고리즘** 의 명칭에 대한 의문이 생기면, 알고리즘 설명 전에 해결하고자 한다 .
- 위키피디아에 따르면 **뗏목 알고리즘** 의 명칭은 특정 단어에서 유래되었지만, 이는 명칭 유래의 일부일 뿐이다 .
- 알고리즘의 명칭은 고안자가 로그 를 떠올리며 합의 알고리즘 으로부터의 탈출을 구상하던 중 얻어낸 것이라고 한다 .
- ‘뗏목’은 로그 통나무를 모아 만든 것이라는 의미에서 비롯되었으며, 이 이야기는 제작자에게 즐거움을 준다 .
- **뗏목 알고리즘** 의 이론을 자세히 다룰 예정이다 .
- 알고리즘의 이름인 '뗏목'에 대한 궁금증을 먼저 해결하고자 한다 .

### 2. '뗏목' 이름의 유래와 의미

- **뗏목 알고리즘** 의 명칭은 단어의 직접적인 유래가 아닌, 네이밍 과정을 통해 얻어진 것이다 .
- 알고리즘을 고안한 사람은 로그와 관련 용어를 떠올리며, 기존 합의 알고리즘에서 어떻게 탈출할지를 생각하다가 이 이름을 얻었다고 밝혔다 .
- 이 과정은 **작은 언어 유희** 로 볼 수 있으며, 개인적으로 이런 네이밍 사연이 마음에 든다고 한다 .

### 3. 🚢 뗏목 합의 알고리즘의 구체적인 동작 방식

- **합의 알고리즘** 은 다수의 참여자가 동일한 의사 결정을 하도록 돕는 알고리즘으로, 한 서버 에서 명령을 실행하기 위해 다른 서버 들에게 합의를 요청한다 .
- 장애 허용 분산 시스템 은 시스템 일부에 오류가 발생해도 정상 작동할 수 있는 시스템을 의미한다 .
- **뗏목 알고리즘** 에서는 모든 노드 가 리더, 팔로워 , 후보자 중 하나의 상태를 가지며, 리더는 명령을 수신, 전파, 응답을 담당한다 .
- 리더는 수신된 명령에 대해 로그 를 생성하여 저장하고, 모든 팔로워 에게 이를 복제하여 전달하며, 클러스터 의 과반수가 정상 응답 시 명령이 수행된다 .
- 리더는 팔로워 들의 동기화를 위해 주기적으로 로그 제어를 반복하며, 네트워크 이슈 로 명령을 처리 못한 팔로워 도 정상 복구 후 리더로부터 로그 를 전달받아 동기화를 맞춘다 .
-

### 1. 합의 알고리즘의 개요

- **합의 알고리즘** 은 여러 참여자가 동일한 의사 결정을 하기 위해 사용된다 .
- 이는 한 서버가 명령을 수행하기 전, 다른 서버들에게 동의를 구하는 과정으로 작동한다 .
- 모든 서버는 같은 상태를 유지하도록 명령을 실행하며, 장애 허용 분산 시스템은 일부 오류가 발생해도 작동할 수 있다 .

### 2. 뗏목 합의 알고리즘의 구성 요소

- **뗏목 합의 알고리즘** 은 모든 노드가 세 가지 상태 중 하나를 갖는다: 리더, 팔로워, 후보자 .
- 리더는 모든 명령을 수신, 전파 및 응답하며, 주기적으로 상태 메시지를 팔로워들에게 전파한다 .
- 팔로워는 리더가 있는 동안 명령을 처리하는 역할만 담당하며 후보자는 리더가 없을 때 새 리더를 정하기 위해 팔로워에서 전환된 상태다 .

### 3. 뗏목 합의 알고리즘의 동작 과정

- 뗏목 합의 알고리즘은 명령을 리더에서 팔로워로 단방향으로 전파되도록 설계되어 있다 .
- 리더는 명령의 로그를 생성하여 로컬에 저장하고, 이를 모든 팔로워에게 복제하여 전달한다 .
- 리더가 수신한 응답이 과반수에 도달하면, 모든 노드가 동일한 명령을 수행하도록 하고 결과를 클라이언트에게 리턴한다 .
- 로그가 클러스터 전체에 동일하게 보유될 때까지 주기적으로 로그를 제어하고, 복구된 팔로워는 그동안의 로그를 다시 전달받아 수행한다 .
- 전체 클러스터의 최신화 및 동기화는 이러한 과정을 통해 이루어진다 .

### 4. 리더의 역할과 중요성

- **리더의 역할은 절대적이다** : 리더는 클러스터의 모든 명령을 수신 및 전파하며, 팔로워들과의 주기적인 상호작용을 통해 시스템을 동일하게 유지한다 .

### 3. 🛶 뗏목 알고리즘의 리더 선출 과정

- 리더를 선출하는 데는 과반수의 승인이 필요한 **다수결** **의 원칙** 을 이용한다 .
- 리더가 없어진 상태에서는 각 노드 가 **팔로워** 상태를 유지하며, **선거 ** **타임아웃** 이 될 때까지 대기한다 .
- 선거 타임아웃 이 가장 먼저 끝난 노드 가 **후보자** 로 전환되고, 즉시 자신에게 한 표를 준 뒤 다른 노드 들에게 투표 요청 을 보낸다 .
- 요청 메시지를 받은 노드 는 후보자 에게 투표를 하고 선거 타임아웃 을 초기화하며, 또 다른 후보자 의 출현을 막는다 .
- 전체 노드 수의 과반수 응답을 얻은 후보자 가 새로운 리더로 선정되어 하트비트 를 전송하고, 팔로워 는 하트비트 를 받을 때마다 선거 타임아웃 을 초기화하면서 팔로워 상태를 유지한다 .
-

### 1. 리더 노드의 선출 과정

- 리더를 선출하기 위해서는 **과반수의 승인** 이 필요한 다수결의 원칙을 이용한다 .
- 클러스터에 리더가 없을 때, 모든 노드는 **팔로어** 상태로 대기하며, 각자의 **선거 타임아웃** 이 끝날 때까지 기다린다 .
- 선거 타임아웃이 가장 먼저 끝난 노드가 **후보자** 로 전환되며, 새로운 선거가 시작된다 .
- 후보자 노드는 자신에게 한 표를 주고, 다른 노드들에게 **투표 요청 메시지** 를 전송한다 .

### 2. 후보자 노드의 투표 과정

- 요청 메시지를 받은 노드는 후보자에게 **투표 메시지** 를 보내고, 자신의 선거 타임아웃을 초기화한다 .
- 현재 투표 과정에 있는 후보자 노드들 외에, 또 다른 후보자가 출현하지 않도록 방지한다 .
- 전체 노드 수의 과반에 해당하는 응답을 얻은 후보자는 새로운 **리더** 로 선정된다 .

### 3. 리더 노드의 역할과 클러스터 유지

- 새로 선출된 리더는 나머지 노드들에게 **하트비트** 를 전송한다 .
- 팔로어 노드는 리더로부터 하트비트를 받을 때마다 자신의 선거 타임아웃을 초기화하여, **팔로어 상태** 를 유지한다 .
- 리더가 정상적으로 동작하면, 하나의 리더와 나머지 팔로워로 이루어진 클러스터 구성이 유지된다 .
- 경우에 따라 **재선거** 를 해야 할 수도 있다 .

### 4. ⚙️ 시스템 장애 상황에서의 알고리즘 안정성 유지

- 네 개의 노드 로 구성된 클러스터 에서 두 명의 후보자 가 동일한 투표수를 얻으면 임기를 종료하고 재선거 를 시작한다 .
- 동점자가 다시 나타나지 않도록, 선거가 시작될 때마다 후보자 노드 의 타임아웃 을 랜덤하게 조정한다 .
- 만약 과반의 득표를 얻을 수 없을 만큼 노드 가 죽은 경우, 리더 부재로 인해 클러스터 관리 기능 전체가 멈추게 된다 .
- 일부 서버 에 장애가 발생한 경우, 합의하지 않은 서버 를 제외하고 나머지 서버 들은 동일한 상태를 유지하게 된다 .
- 절반 이상의 서버 가 장애가 발생하면, 리더의 합의 요청이 목표에 도달하지 못해 클러스터 운용이 중단된다 .
-

### 1. 분할 투표와 선거 과정의 조정

- 네 개의 노드로 구성된 클러스터에서 두 개의 후보자가 동시에 나타나 각각 두 표씩 얻는 현상을 **분할 투표** 라고 한다 .
- 분할 투표가 발생하면 임기가 종료되고, 새로운 임기와 함께 재선거가 시작된다 .
- 매 선거 시작 시마다 후보자 노드들의 선거 타임아웃을 랜덤하게 조정하여 같은 상황이 반복되지 않도록 한다 .
- 이후 선거는 앞서 설명한 방식으로 재진행된다 .

### 2. 리더 부재 시의 클러스터 동작

- 클러스터에서 과반수 이상이 득표할 수 없는 상황이 되면, 리더의 부재로 인해 클러스터 관리 기능이 멈추게 된다 .
- 이러한 상황에서도 클러스터로 들어오는 명령은 리더를 통해서만 전파되기 때문에 리더 부재는 치명적이다 .

### 3. 장애 상황에서의 시스템 동작 요약

- 모든 서버가 정상 작동 시에는 리더 노드가 명령을 수신하고 다른 서버들에게 합의를 요청하여 모두가 동일한 상태를 유지한다 .
- 일부 서버가 장애 상태일 경우, 장애가 발생한 서버는 명령을 수행하지 못하며, 나머지 서버들은 동일한 상태를 유지한다 .
- 절반 이상의 서버에 장애가 발생하면 합의가 이루어지지 않아 명령이 전파되지 않고, 클러스터 운용이 중단된다 .

### 5. 🔍 정족수의 중요성과 내결함성 유지

- 합의 알고리즘 에서 **정족수** 란 클러스터 의 전체 노드 수 중 최소 과반수의 응답을 얻어야 하는 원칙을 지칭하며, 이는 분산 시스템 에서 변화를 적용하기 위한 필수 조건이다 .
- 정족수 는 내결함성 을 유지하는 데 필요하며, 정상 상태가 유지될 경우 일부 노드 에 문제가 생기더라도 클러스터 전체가 다운되지 않도록 보장한다 .
- 전체 노드 수를 세 개 이상의 홀수로 유지하는 것이 권장되며, 이는 장애를 허용할 수 있는 비율을 높이기 위해서다 .
- 홀수로 구성된 노드 는 짝수로 구성된 것보다 더 높은 효율성을 제공하며, 내결함성 과 관리 기능 유지에 좋다 .
- 리더 선출 과정과 명령 처리 지연을 줄이기 위해서라도 홀수 노드 운영이 더 권장된다 .
-

### 1. 정족수의 중요성과 효과

- **정족수** 는 합의 알고리즘에서 필수적인 개념으로, 변화를 적용할 때 전체 노드의 과반수 응답이 필요하다 .
- 정족수는 클러스터의 관리 기능 유지와 **내결함성** 을 보장하는 데 기여한다 .
- 과반수 노드가 정상 상태를 유지하면, 나머지 노드에 문제가 생기더라도 클러스터 전체에 다운타임이 발생하지 않는다 .
- 정족수가 충족되지 않으면, 클러스터는 정상적으로 기능할 수 없다 .

### 2. 홀수 노드 구성의 장점

- 세 개 이상의 홀수 노드로 구성하는 것이 권장되며, 이는 클러스터의 내결함성을 확보한다 .
- 홀수 노드 구성 시 허용 가능한 장애 노드 수의 비율이 높다 .
- 클러스터를 홀수 노드로 구성하는 것이 짝수일 때보다 효율적이며, 같은 내결함성을 더 적은 노드로 얻을 수 있다 .
- 불필요한 투표와 명령 처리 지연을 줄이기 위해, 홀수 노드 운영이 권장된다 .

### 핵심 포인트

- 뗏목 알고리즘은 내결함성과 간결성을 특징으로 하며, 리더 중심 구조와 정족수 원칙을 통해 안정적인 분산 시스템 운영을 보장.
